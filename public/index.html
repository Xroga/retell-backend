<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>DrJoy ‚Äî AI Voice Agent (Demo)</title>
<style>
:root{
  --bg:#07090a;
  --panel:#0f1416;
  --neon:#00f27a;
  --neon-2:#00a0ff;
  --muted:#9aa3a6;
  --white:#e9f7f0;
  --card-radius:16px;
  --shadow:0 8px 32px rgba(0,0,0,.6);
  --ease:cubic-bezier(.2,.9,.2,1);
}

*{box-sizing:border-box}
body{
  margin:0;
  font-family:Inter,system-ui,Arial;
  background:var(--bg);
  color:var(--white);
  display:flex;
  justify-content:center;
  align-items:flex-start;
  min-height:100vh;
  padding:20px;
}
.stage{width:100%;max-width:860px;display:flex;flex-direction:column;gap:20px}

.panel{
  display:flex;flex-direction:column;
  background:rgba(255,255,255,.02);
  border-radius:var(--card-radius);
  box-shadow:var(--shadow);
  overflow:hidden;
}

.header{
  padding:16px;
  display:flex;align-items:center;justify-content:space-between;
  background:rgba(255,255,255,.02)
}
.brand{display:flex;align-items:center;gap:12px}
.badge{width:48px;height:48px;border-radius:12px;background:linear-gradient(135deg,var(--neon),var(--neon-2));display:flex;align-items:center;justify-content:center;font-weight:800;color:#021012}

.offer{font-size:13px;color:var(--neon)}

.body{padding:18px;display:flex;flex-direction:column;gap:16px}
.status{display:flex;align-items:center;justify-content:space-between}
.dot{width:12px;height:12px;border-radius:50%;background:#444}
.dot.live{background:var(--neon);box-shadow:0 0 12px var(--neon)}
.timer{font-weight:700;color:var(--neon)}

.wave{display:flex;gap:6px;height:50px;align-items:flex-end;margin-top:12px}
.bar{width:6px;background:linear-gradient(180deg,var(--neon),#00b86b);border-radius:6px;animation:wiggle .9s infinite ease-in-out}
.bar:nth-child(2){animation-duration:.6s;height:40px}
.bar:nth-child(3){animation-duration:.7s;height:20px}
.bar:nth-child(4){animation-duration:.5s;height:55px}
.bar:nth-child(5){animation-duration:.8s;height:28px}
@keyframes wiggle{0%{transform:scaleY(.3)}50%{transform:scaleY(1.2)}100%{transform:scaleY(.4)}}

.controls{display:flex;gap:10px;flex-wrap:wrap}
.btn{padding:8px 14px;border-radius:10px;border:none;font-weight:700;cursor:pointer;transition:transform .1s}
.btn:active{transform:scale(.96)}
.btn.green{background:linear-gradient(90deg,var(--neon),var(--neon-2));color:#021012}
.btn.ghost{background:transparent;border:1px solid rgba(255,255,255,.1);color:var(--white)}

.transcript{background:rgba(0,0,0,.25);border-radius:12px;padding:12px;min-height:180px;overflow:auto}
.bubble{margin-bottom:10px;padding:10px;border-radius:10px;max-width:80%}
.bubble.user{background:rgba(255,255,255,.08);align-self:flex-end;color:var(--muted)}
.bubble.ai{background:rgba(0,242,122,.1);color:var(--white);font-weight:600;align-self:flex-start}

.footer{text-align:center;font-size:12px;color:var(--muted);margin-top:10px}

@media(max-width:600px){
  .header{flex-direction:column;gap:10px}
}
</style>
</head>
<body>
<div class="stage">
  <div class="panel">
    <div class="header">
      <div class="brand"><div class="badge">DJ</div><div><strong>DrJoy Voice Agent</strong></div></div>
      <div class="offer">üéÅ 14-Day Free Trial</div>
    </div>
    <div class="body">
      <div class="status">
        <div><span class="dot live" id="dot"></span> <span id="status">Live</span></div>
        <div class="timer" id="timeLeft">01:40:00</div>
      </div>
      <div class="wave"><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div></div>
      <div class="controls">
        <button class="btn green" id="startBtn">üéô Start</button>
        <button class="btn ghost" id="stopBtn">‚ñ† Stop</button>
        <button class="btn ghost" id="endBtn">‚úñ End</button>
        <button class="btn ghost" id="muteBtn">üîá Mute</button>
      </div>
      <div class="transcript" id="transcript">
        <div class="bubble ai">üëã Hello ‚Äî press Start to begin.</div>
      </div>
    </div>
  </div>
  <div class="footer">¬© 2025 DrJoy ‚Äî White-label AI Reception</div>
</div>

<script>
const AGENT_ID = "agent_58f0534d675f68827aa932c9db"; // replace with yours
const transcript=document.getElementById("transcript");
const status=document.getElementById("status");
const timeLeft=document.getElementById("timeLeft");
const startBtn=document.getElementById("startBtn");
const stopBtn=document.getElementById("stopBtn");
const endBtn=document.getElementById("endBtn");
const muteBtn=document.getElementById("muteBtn");

let ws=null,localStream=null,audioCtx=null,processor=null;
let countdown=null,endTime=null,pausedTime=null;

// restore timer state from localStorage
if(localStorage.state){
  const saved=JSON.parse(localStorage.state);
  endTime=saved.endTime||null;
  pausedTime=saved.pausedTime||null;
  if(endTime && !pausedTime) startCountdown(); // running
  if(pausedTime) timeLeft.textContent=formatTime(pausedTime); // stopped
}

function addBubble(text,who="ai"){
  const d=document.createElement("div");
  d.className="bubble "+who;
  d.textContent=text;
  transcript.appendChild(d);
  transcript.scrollTop=transcript.scrollHeight;
}

function formatTime(ms){
  const s=Math.max(0,Math.floor(ms/1000));
  const h=String(Math.floor(s/3600)).padStart(2,"0");
  const m=String(Math.floor((s%3600)/60)).padStart(2,"0");
  const sec=String(s%60).padStart(2,"0");
  return `${h}:${m}:${sec}`;
}

function saveState(){
  localStorage.state=JSON.stringify({endTime,pausedTime});
}

function startCountdown(){
  if(!endTime) endTime=Date.now()+100*60*1000; // 100 mins
  pausedTime=null;
  saveState();
  if(countdown) clearInterval(countdown);
  countdown=setInterval(()=>{
    const remain=endTime-Date.now();
    if(remain<=0){
      clearInterval(countdown);
      countdown=null;
      endTime=null;
      pausedTime=null;
      localStorage.removeItem("state");
      timeLeft.textContent="00:00:00";
    } else {
      timeLeft.textContent=formatTime(remain);
    }
  },1000);
}

function pauseCountdown(){
  if(countdown){ clearInterval(countdown); countdown=null; }
  if(endTime){
    pausedTime=endTime-Date.now();
    endTime=null;
    timeLeft.textContent=formatTime(pausedTime);
    saveState();
  }
}

function resumeCountdown(){
  if(pausedTime){
    endTime=Date.now()+pausedTime;
    pausedTime=null;
    saveState();
    startCountdown();
  }
}

async function startRealtime(){
  try{
    status.textContent="üü° Connecting...";
    const res=await fetch("/api/start-call",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({agent_id:AGENT_ID})});
    const data=await res.json();
    ws=new WebSocket(data.ws_url||data.websocket_url);
    ws.binaryType="arraybuffer";
    ws.onopen=()=>{status.textContent="üü¢ Connected";addBubble("Connected to Retell","ai");};
    ws.onmessage=(ev)=>{try{const msg=JSON.parse(ev.data);
      if(msg.type==="transcript.final") addBubble(msg.text,"user");
      if(msg.type==="response.output_text.delta") addBubble(msg.delta,"ai");
    }catch(e){}};
    ws.onclose=()=>{status.textContent="üî¥ Disconnected";};
    localStream=await navigator.mediaDevices.getUserMedia({audio:true});
    audioCtx=new(window.AudioContext||window.webkitAudioContext)();
    const src=audioCtx.createMediaStreamSource(localStream);
    processor=audioCtx.createScriptProcessor(2048,1,1);
    processor.onaudioprocess=(e)=>{
      if(!ws||ws.readyState!==1)return;
      const input=e.inputBuffer.getChannelData(0);
      const buffer=new ArrayBuffer(input.length*2);
      const view=new DataView(buffer);
      for(let i=0;i<input.length;i++){
        let s=Math.max(-1,Math.min(1,input[i]));
        view.setInt16(i*2,s<0?s*0x8000:s*0x7fff,true);
      }
      ws.send(buffer);
    };
    src.connect(processor);processor.connect(audioCtx.destination);
  }catch(e){console.error(e);addBubble("‚ö†Ô∏è Backend failed","ai");}
}

function stopAll(){
  if(ws){ws.close();ws=null;}
  if(processor){processor.disconnect();processor=null;}
  if(audioCtx){audioCtx.close();audioCtx=null;}
  if(localStream){localStream.getTracks().forEach(t=>t.stop());localStream=null;}
  status.textContent="‚ö´ Stopped";
}

// ------------------- BUTTONS -------------------

startBtn.onclick=()=>{
  if(pausedTime){ resumeCountdown(); }
  else { startCountdown(); }
  startRealtime();
  startBtn.disabled=true;
};

stopBtn.onclick=()=>{
  stopAll();
  pauseCountdown();   // stop at exact time
  startBtn.disabled=false;
};

endBtn.onclick=()=>{
  stopAll();
  if(countdown) clearInterval(countdown);
  countdown=null;
  pausedTime=null;
  endTime=null;
  localStorage.removeItem("state");
  timeLeft.textContent="00:00:00";
  startBtn.disabled=false;
};

muteBtn.onclick=()=>{
  if(localStream) localStream.getAudioTracks().forEach(t=>t.enabled=!t.enabled);
};
</script>

<!-- ================= FEATURES & FAQ SECTION ================= -->
<section class="features-faq">
  <div class="container">
    <!-- Heading -->
    <div class="section-heading">
      <h2>Why Choose Our AI Voice Agent?</h2>
      <p>
        Powered by <span class="highlight">Retell AI</span> ‚Äì the most advanced real-time conversational AI.  
        Here‚Äôs what sets us apart:
      </p>
    </div>

    <!-- Features Grid -->
    <div class="features-grid">
      <div class="feature-card">
        <div class="icon">‚ö°</div>
        <h3>Real-Time Conversations</h3>
        <p>Instant responses with <span class="highlight">human-like speed</span> and accuracy.</p>
      </div>
      <div class="feature-card">
        <div class="icon">üåç</div>
        <h3>Multilingual Support</h3>
        <p>Communicate in multiple languages fluently for <span class="highlight">global reach</span>.</p>
      </div>
      <div class="feature-card">
        <div class="icon">üîó</div>
        <h3>Seamless Integrations</h3>
        <p>Connect with your CRM, website, or apps effortlessly.</p>
      </div>
    </div>

    <!-- FAQ Section -->
    <div class="faq">
      <h3 class="faq-heading">Frequently Asked Questions</h3>
      <div class="faq-item">
        <button class="faq-question">How does Retell AI voice agent work?<span>+</span></button>
        <div class="faq-answer">
          The AI listens in real-time, processes queries instantly, and responds naturally ‚Äî just like a human agent.
        </div>
      </div>
      <div class="faq-item">
        <button class="faq-question">Can it handle multiple calls at once?<span>+</span></button>
        <div class="faq-answer">
          Yes, the system scales effortlessly ‚Äî handling thousands of conversations simultaneously.
        </div>
      </div>
      <div class="faq-item">
        <button class="faq-question">Do I need coding knowledge to use it?<span>+</span></button>
        <div class="faq-answer">
          No ‚Äî everything is plug-and-play. Simply connect your business, and our AI takes care of the rest.
        </div>
      </div>
    </div>
  </div>
</section>

<!-- ================= CSS STYLE ================= -->
<style>
.features-faq {
  background: linear-gradient(135deg, #0d0d0d, #111, #0b2e0b);
  color: #fff;
  padding: 80px 20px;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  position: relative;
  overflow: hidden;
}
.features-faq::before {
  content: "";
  position: absolute;
  inset: 0;
  background: radial-gradient(circle, rgba(0,255,128,0.15) 0%, transparent 70%);
  animation: glow 6s infinite alternate;
}
@keyframes glow {
  from { transform: scale(1); opacity: 0.6; }
  to { transform: scale(1.2); opacity: 0.3; }
}

.container {
  max-width: 1200px;
  margin: 0 auto;
  position: relative;
  z-index: 1;
}

.section-heading {
  text-align: center;
  margin-bottom: 50px;
}
.section-heading h2 {
  font-size: 2.8rem;
  font-weight: 800;
  color: #00ff88;
  margin-bottom: 15px;
  text-shadow: 0 0 10px rgba(0,255,136,0.5);
  animation: pulse 2s infinite;
}
.section-heading p {
  font-size: 1.1rem;
  color: #bbb;
}
.highlight {
  color: #00ff88;
  font-weight: bold;
}

@keyframes pulse {
  0%, 100% { text-shadow: 0 0 8px rgba(0,255,136,0.7); }
  50% { text-shadow: 0 0 20px rgba(0,255,136,1); }
}

/* Features Grid */
.features-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
  gap: 30px;
}
.feature-card {
  background: rgba(20, 20, 20, 0.9);
  border: 1px solid rgba(0, 255, 136, 0.2);
  border-radius: 18px;
  padding: 30px;
  text-align: center;
  transition: transform 0.3s, box-shadow 0.3s;
  box-shadow: 0 0 15px rgba(0, 255, 136, 0.15);
}
.feature-card:hover {
  transform: translateY(-8px) scale(1.03);
  box-shadow: 0 0 25px rgba(0, 255, 136, 0.4);
}
.feature-card .icon {
  font-size: 2.5rem;
  margin-bottom: 15px;
  color: #00ff88;
  animation: float 3s ease-in-out infinite;
}
.feature-card h3 {
  font-size: 1.3rem;
  margin-bottom: 10px;
  color: #fff;
}
.feature-card p {
  font-size: 1rem;
  color: #aaa;
}

@keyframes float {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-8px); }
}

/* FAQ */
.faq {
  margin-top: 70px;
}
.faq-heading {
  text-align: center;
  font-size: 2rem;
  margin-bottom: 30px;
  color: #00ff88;
}
.faq-item {
  background: rgba(20,20,20,0.8);
  border: 1px solid rgba(0,255,136,0.2);
  margin-bottom: 15px;
  border-radius: 12px;
  overflow: hidden;
}
.faq-question {
  width: 100%;
  background: none;
  border: none;
  outline: none;
  color: #fff;
  font-size: 1.1rem;
  padding: 18px 20px;
  text-align: left;
  display: flex;
  justify-content: space-between;
  cursor: pointer;
  font-weight: 600;
  transition: background 0.3s;
}
.faq-question:hover {
  background: rgba(0,255,136,0.1);
}
.faq-answer {
  max-height: 0;
  overflow: hidden;
  padding: 0 20px;
  color: #bbb;
  font-size: 0.95rem;
  line-height: 1.5;
  transition: max-height 0.4s ease, padding 0.3s ease;
}
.faq-item.active .faq-answer {
  max-height: 200px;
  padding: 15px 20px 20px;
}
.faq-item.active .faq-question span {
  transform: rotate(45deg);
}
.faq-question span {
  transition: transform 0.3s;
  color: #00ff88;
}
</style>

<!-- ================= FAQ JS ================= -->
<script>
  const faqs = document.querySelectorAll('.faq-item');
  faqs.forEach(faq => {
    faq.querySelector('.faq-question').addEventListener('click', () => {
      faq.classList.toggle('active');
    });
  });
</script>
<!-- ================= END FEATURES & FAQ SECTION ================= -->

</body>
</html>
